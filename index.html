<script>
    async function connectWallet() {
        console.log("ウォレット接続を試みます...");

        if (!window.solana || !window.solana.isPhantom) {
            alert("Phantomウォレットがインストールされていません。");
            return;
        }

        console.log("Phantomウォレットが検出されました:", window.solana);

        try {
            const response = await window.solana.connect();
            console.log("ウォレット接続成功:", response.publicKey.toString());
            document.getElementById("walletAddress").textContent = `ウォレット: ${response.publicKey.toString()}`;

            // 🚀 RPCエンドポイントを「認証不要なもの」に変更
            const connection = new solanaWeb3.Connection("https://api.mainnet-beta.solana.com", "confirmed");

            // SOL 残高取得
            try {
                const solBalance = await connection.getBalance(new solanaWeb3.PublicKey(response.publicKey.toString()));
                document.getElementById("solBalance").textContent = `SOL 残高: ${(solBalance / solanaWeb3.LAMPORTS_PER_SOL).toFixed(4)} SOL`;
            } catch (solError) {
                console.error("SOL残高取得エラー:", solError.message);
                document.getElementById("solBalance").textContent = "SOL 残高: エラー";
            }

            // GRI トークン残高取得
            const GRI_TOKEN_MINT_ADDRESS = "Va7yuUnSYdg23QjHjPAc9fkBrK3oD4mr3Ee52vFcyev";
            try {
                const tokenAccounts = await connection.getParsedTokenAccountsByOwner(
                    new solanaWeb3.PublicKey(response.publicKey.toString()),
                    { programId: new solanaWeb3.PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA") }
                );

                let griBalance = 0;
                tokenAccounts.value.forEach(account => {
                    const mint = account.account.data.parsed.info.mint;
                    if (mint === GRI_TOKEN_MINT_ADDRESS) {
                        griBalance = account.account.data.parsed.info.tokenAmount.uiAmount;
                    }
                });

                document.getElementById("griBalance").textContent = `GRI 残高: ${griBalance} GRI`;

            } catch (griError) {
                console.error("GRIトークン取得エラー:", griError.message);
                document.getElementById("griBalance").textContent = "GRI 残高: エラー";
            }

        } catch (error) {
            console.error("ウォレット接続エラー:", error.message);
            alert(`ウォレット接続に失敗しました: ${error.message}`);
        }
    }

    document.getElementById("connectWallet").addEventListener("click", connectWallet);
</script>

<!-- Solana Web3.js -->
<script src="https://unpkg.com/@solana/web3.js@1.30.0/lib/index.iife.min.js"></script>
